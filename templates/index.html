<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Tab</title>
    <style>
        body{
            background-color:{{ntBackgroundcolor}};
            color:{{ntTextcolor}};
            text-align:center;
            background-image: url('{{ url_for("static", filename=backgroundImage) }}');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }
        h1{
            color: {{ntTextcolor}};
        }
        input{
            border-style:solid;
            border-color:{{ntBordercolor}};
            width: 50%;
            /*padding: 1px;*/
            margin-top: 10px;
            background-color:{{ntBarcolor}};
            border-radius:25px;
            padding: 12px 2px;
            margin: 20px 0px;
        }
        button{
            background-color:{{ntButtoncolor}};
            color:{{ntTextcolor}};
            border:none;
            padding:5px 10px;}
        #searchB{
            cursor:pointer;
        }
        input::placeholder {
        color: {{ntBackgroundcolor}}; 
        }
        
    #autocomplete-list {
        border: 1px solid #ccc;
        background-color: #fff;
        max-height: 200px;
        overflow-y: auto;
        padding: 0;
        margin: 0;
        list-style: none;
        position: absolute;
        width: 50%; /* match input width */
        display: none;
        z-index: 1000;
    }
    #autocomplete-list li {
        padding: 5px 10px;
        cursor: pointer;
    }
    #autocomplete-list li:hover {
       background-color: #eee;
    }

    </style>
</head>
<body>
    <h1>New Tab</h1>
    <div id="bar" style="margin:auto; border-width:7px; position:relative;">
        <form method="get" id="ddgSearch" action="https://duckduckgo.com/" target="_blank">
            <!--k7=Background-->
            <input type="hidden" name="k7" value="{{ddgBackgroundcolor}}"/> <!--k1=Ads-->
            <!--k1 ads-->
            <input type="hidden" name="k1" value="-1"/>
            <!--k8=Text-->
            <input type="hidden" name="k8" value="{{ddgTextcolor}}"/>
            <!--k9=Links-->
            <input type="hidden" name="k9" value="{{ddgLinkcolor}}"/>
            <!--kx=URLs-->
            <input type="hidden" name="kx" value="{{ddgURLcolor}}"/>
            <!--kj=Header-->
            <input type="hidden" name="kj" value="{{ddgHeadercolor}}"/>
            <!--kt=Font-->
            <input type="hidden" name="kt" value="c"/>
            <!--kp=Safe Search-->
            <input type="hidden" name="kp" value="1"/>
            <input type="text" name="q" id="search" placeholder="{{funPlaceholder}}" aria-label="Search on DuckDuckGo"/>
            <ul id="autocomplete-list"></ul>
            <button type="submit" id="searchB">Search</button>
        </form>
    </div>

    
<script>
const input = document.getElementById('search');
const list = document.getElementById('autocomplete-list');
const form = document.getElementById('ddgSearch');

// Ensure the parent container is relatively positioned
const bar = document.getElementById('bar');
bar.style.position = 'relative';

// Helper to create a list item
function createItem(text) {
    const item = document.createElement('li');
    item.textContent = text;
    item.style.padding = '5px 10px';
    item.style.cursor = 'pointer';
    item.style.listStyle = 'none';

    item.addEventListener('click', async () => {
        input.value = text;
        list.style.display = 'none';

        // Send used search to backend to update history
        try {
            await fetch('/update-history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: text })
            });
        } catch (e) {
            console.error('Failed to update history:', e);
        }

        // Submit the form
        form.submit();
    });

    return item;
}

// Fetch suggestions as user types
input.addEventListener('input', async () => {
    const query = input.value.trim();
    if (!query) {
        list.style.display = 'none';
        return;
    }

    try {
        const response = await fetch(`/suggestions?q=${encodeURIComponent(query)}`);
        const suggestions = await response.json();

        // Clear previous suggestions
        list.innerHTML = '';

        suggestions.forEach(s => {
            list.appendChild(createItem(s));
        });

        if (suggestions.length > 0) {
            list.style.display = 'block';
            list.style.position = 'absolute';
            list.style.top = `${input.offsetTop + input.offsetHeight}px`;
            list.style.left = `${input.offsetLeft}px`;
            list.style.width = `${input.offsetWidth}px`;
            list.style.zIndex = '1000';
            list.style.backgroundColor = '#fff';
            list.style.border = '1px solid #ccc';
            list.style.maxHeight = '200px';
            list.style.overflowY = 'auto';
            list.style.padding = '0';
            list.style.margin = '0';
        } else {
            list.style.display = 'none';
        }
    } catch (error) {
        console.error('Autocomplete error:', error);
        list.style.display = 'none';
    }
});

// Hide suggestions if clicking outside
document.addEventListener('click', (e) => {
    if (!bar.contains(e.target)) {
        list.style.display = 'none';
    }
});

// Optional: update history on form submit if user typed something manually
form.addEventListener('submit', async (e) => {
    const query = input.value.trim();
    if (!query) return;
    try {
        await fetch('/update-history', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query })
        });
    } catch (e) {
        console.error('Failed to update history:', e);
    }
});
</script>






    <div>
        <form method="POST" action="/set-theme">
        <label for="darkModeSelect">Theme:</label>
            <select name="theme" id="darkModeSelect">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
            </select>
            <button type="submit">Apply</button>
        </form>
    </div>

</body>